<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EchoingTide1822 - James Gill</title>

  <style>
    :root{
      --panel-bg: rgba(10,10,30,0.55);
      --accent-cyan: #00ffff;
      --accent-magenta: #ff00ff;
      --text-color: #e6e9ff;
      --muted: #97a0ff;
      --panel-blur: 8px;
      --bg-color: #000;
    }
    [data-theme="ocean"]{
      --panel-bg: rgba(0,30,50,0.65);
      --accent-cyan: #00d4ff;
      --accent-magenta: #0088ff;
      --text-color: #d0f0ff;
      --muted: #7ac5ff;
      --bg-color: #001a2e;
    }
    [data-theme="forest"]{
      --panel-bg: rgba(10,35,15,0.65);
      --accent-cyan: #00ff88;
      --accent-magenta: #88ff00;
      --text-color: #d8ffe8;
      --muted: #7dff99;
      --bg-color: #0a1f0a;
    }
    [data-theme="sunset"]{
      --panel-bg: rgba(50,20,10,0.65);
      --accent-cyan: #ff8800;
      --accent-magenta: #ff0066;
      --text-color: #ffe8d0;
      --muted: #ffaa77;
      --bg-color: #1a0f00;
    }
    [data-theme="purple"]{
      --panel-bg: rgba(40,10,50,0.65);
      --accent-cyan: #cc00ff;
      --accent-magenta: #ff00cc;
      --text-color: #f0d0ff;
      --muted: #d088ff;
      --bg-color: #1a001a;
    }
    [data-theme="neon"]{
      --panel-bg: rgba(10,10,30,0.55);
      --accent-cyan: #00ffff;
      --accent-magenta: #ff00ff;
      --text-color: #e6e9ff;
      --muted: #97a0ff;
      --bg-color: #000;
    }

    /* === Enhanced Theme Variants (dramatic changes) === */
    body.theme-a {
      --accent-cyan:#00ffe0; --accent-magenta:#ff5ae6; --panel-bg:rgba(5,15,40,.65);
      font-family:'Segoe UI',system-ui,sans-serif;
    }
    body.theme-b {
      --accent-cyan:#ffca00; --accent-magenta:#ff5a00; --panel-bg:rgba(50,25,0,.55);
      font-family:'Georgia',serif;
    }
    body.theme-c {
      --accent-cyan:#67ff00; --accent-magenta:#00ff95; --panel-bg:rgba(10,50,10,.55);
      font-family:'Courier New',monospace;
    }
    body.theme-d {
      --accent-cyan:#bb66ff; --accent-magenta:#ff33aa; --panel-bg:rgba(35,10,50,.55);
      font-family:'Trebuchet MS',sans-serif;
    }
    body.theme-e {
      --accent-cyan:#33d1ff; --accent-magenta:#ff3377; --panel-bg:rgba(0,0,0,.55);
      font-family:'Verdana',sans-serif;
    }
    body.theme-a .btn{border-radius:40px;font-size:.95rem}
    body.theme-b .btn{border-radius:8px;font-weight:700;font-size:1rem;letter-spacing:.5px}
    body.theme-c .btn{border-radius:0;font-size:.9rem;border:2px solid var(--accent-cyan)}
    body.theme-d .btn{border-radius:20px 4px 20px 4px;font-size:1.05rem}
    body.theme-e .btn{border-radius:999px;font-size:.95rem;box-shadow:0 0 0 2px rgba(255,255,255,.08)}
    body.theme-c .panel{border-radius:0}
    body.theme-b .panel{border:2px solid rgba(255,255,255,.15)}
    body.theme-d .panel{border-radius:24px}
    body.theme-a .panel{-webkit-backdrop-filter:blur(12px);backdrop-filter:blur(12px)}
    body.theme-e .panel{outline:1px solid rgba(255,255,255,.12)}
    .panel-event-burst{position:absolute;inset:0;pointer-events:none;overflow:hidden;border-radius:inherit}
    .panel-event-particle{position:absolute;background:radial-gradient(circle,#fff,var(--accent-cyan));width:6px;height:6px;border-radius:50%;will-change:transform,opacity;mix-blend-mode:screen}

    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:var(--bg-color);color:var(--text-color);transition:background-color 0.6s ease}
    .video-background{position:fixed;inset:0;z-index:0;overflow:hidden;background:var(--bg-color);transition:opacity .6s ease}
    .video-background video{position:absolute;top:50%;left:50%;min-width:100%;min-height:100%;transform:translate(-50%,-50%);object-fit:cover;filter:contrast(1.02) saturate(1.05) brightness(0.9);image-rendering:-webkit-optimize-contrast;image-rendering:-webkit-crisp-edges;image-rendering:crisp-edges}
    .video-background video::-webkit-media-controls{display:none !important}
    .video-background video::-webkit-media-controls-enclosure{display:none !important}
    .retro-overlay{position:fixed;inset:0;z-index:1;pointer-events:none;background-image:linear-gradient(transparent 60%, rgba(0,0,0,0.12) 100%), radial-gradient(circle at 50% 10%, rgba(255,255,255,0.03), transparent 20%);mix-blend-mode:overlay}

    /* Blackout overlay for fade-to-black */
    #blackout{position:fixed;inset:0;background:#000;z-index:9000;opacity:0;pointer-events:none;transition:opacity .8s ease;display:none}
    #blackout.show{display:block}
    #blackout.visible{opacity:1}

    .container{position:relative;z-index:2;min-height:100vh;display:flex;flex-direction:column;gap:1rem;align-items:center;padding:3.5rem 1rem}

    /* High-contrast top bar */
    .topbar{width:min(1100px,100%);background:rgba(0,0,0,0.55);border:1px solid rgba(255,255,255,0.08);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:14px;padding:1rem 1rem 1.1rem;box-shadow:0 8px 30px rgba(0,0,0,0.35)}
    h1{font-size:clamp(1.4rem,2.6vw,2.2rem);text-align:center;margin-bottom:.7rem;text-shadow:0 2px 10px rgba(0,0,0,.65)}
    .controls{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;justify-content:center}
    .btn{display:inline-flex;align-items:center;gap:.5rem;background:rgba(0,0,0,0.55);color:var(--text-color);border:1px solid rgba(255,255,255,0.16);padding:.6rem 1rem;border-radius:999px;cursor:pointer;transition:transform .18s,box-shadow .18s,background .2s;font-weight:600}
    .btn:hover{transform:translateY(-2px);box-shadow:0 10px 28px rgba(0,0,0,.55);background:rgba(0,0,0,0.7)}
    .linkedin-btn{background:linear-gradient(90deg,#0077b5,#00a0dc);color:#fff;border:none;padding:.6rem 1rem}
    .panels{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem;width:min(1100px,100%);margin:0 auto}
    .panel{background:var(--panel-bg);border-radius:12px;padding:1rem;box-shadow:0 8px 30px rgba(16,14,28,0.6);-webkit-backdrop-filter:blur(var(--panel-blur));backdrop-filter:blur(var(--panel-blur));border:1px solid rgba(255,255,255,0.08);transition:transform .22s,box-shadow .22s,background-color 0.4s ease;min-height:90px;position:relative;cursor:pointer}
    .panel:hover{transform:translateY(-3px);box-shadow:0 12px 40px rgba(16,14,28,0.8)}
    .panel[aria-expanded="true"]{transform:translateY(-6px)}
    .panel h3{color:var(--muted);font-size:1rem;margin-bottom:.4rem;display:flex;justify-content:space-between;align-items:center;gap:.5rem;pointer-events:none}
    .panel .body{color:var(--text-color);line-height:1.45;margin-top:0.5rem}
    .panel .body ul{padding-left:1.1rem}
    .panel .body li{margin:.25rem 0}
    .panel .body h4{margin:.6rem 0 .25rem;color:var(--accent-cyan);font-size:1rem}
    footer{margin-top:1.25rem;color:rgba(151,160,255,0.85);font-size:.9rem;text-align:center}

    /* Hidden celebrate button */
    #hiddenCelebrate{position:fixed;bottom:20px;right:20px;width:60px;height:60px;background:transparent;border:none;cursor:pointer;z-index:9999;opacity:0}
    #hiddenCelebrate:hover{opacity:0.1}

    /* Warp speed overlay */
    .warp-overlay{position:fixed;inset:0;z-index:10000;pointer-events:none;display:none;overflow:hidden}
    .warp-overlay.active{display:block}
    .star{position:absolute;background:white;border-radius:50%;will-change:transform,width,height,opacity}

    /* cursor trail */
    .cursor-core{position:fixed;width:16px;height:16px;border-radius:50%;background:radial-gradient(circle, var(--accent-cyan), var(--accent-magenta));pointer-events:none;z-index:9999;mix-blend-mode:screen;transform:translate(-50%,-50%);opacity:.95;transition:transform .06s linear;box-shadow:0 0 20px var(--accent-cyan), 0 0 40px var(--accent-magenta);display:none}
    .cursor-trail-dot{position:fixed;border-radius:50%;pointer-events:none;z-index:9998;mix-blend-mode:screen;transition:transform .08s linear,opacity .2s linear}

    @media(max-width:520px){
      .container{padding:2rem 1rem}
      .topbar{padding:.9rem}
    }
    .warp-overlay video.warp-player{
  position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
  background:#000; /* ensures no see-through edges */
}

    /* Cinematic FX layers */
    #lensFlareFX{position:fixed;inset:0;pointer-events:none;z-index:11005;background:
radial-gradient(circle at 50% 50%,rgba(255,255,255,.25),rgba(255,255,255,0) 60%);
mix-blend-mode:screen;opacity:0;transition:opacity .35s linear,transform .35s ease}
#starFX{position:fixed;inset:0;pointer-events:none;z-index:11000;opacity:0;transition:opacity .8s ease}
#starFX .sx{position:absolute;width:3px;height:3px;background:#fff;border-radius:50%;will-change:transform,opacity}
#cinReady{position:fixed;bottom:14px;right:14px;width:10px;height:10px;border-radius:50%;
background:radial-gradient(circle,#0ff,#00a0a0);box-shadow:0 0 10px #0ff;
opacity:.15;z-index:9999;display:none;pointer-events:none;transition:opacity .6s ease}
    /* Fade to black overlay (last video) */
    #cinBlackFade{position:fixed;inset:0;background:#000;z-index:12040;pointer-events:none;
opacity:0;transition:opacity 1.1s ease}
  </style>
</head>
<body data-theme="neon">
  <!-- Video + overlay -->
  <div class="video-background" aria-hidden="true" id="videoBg">
    <video autoplay muted loop id="bg-video" preload="auto" disablePictureInPicture poster="">
      <source src="background-final.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>
  <div class="retro-overlay" aria-hidden="true"></div>
  <div class="warp-overlay" id="warpOverlay"></div>
  <div id="blackout"></div>

  <main class="container">
    <div class="topbar">
      <h1>Career Lifeline – James Gill</h1>
      <div class="controls" role="toolbar" aria-label="Page controls">
        <a class="btn linkedin-btn" href="https://linkedin.com/in/james-gill-echoing1822tide" target="_blank" rel="noopener noreferrer">Connect on LinkedIn</a>
        <button id="themeToggleBtn" class="btn" title="Theme change (T)">Theme change</button>
        <button id="mouseTrailToggleBtn" class="btn" title="Toggle mouse trail (M)">Mouse Trail</button>
      </div>
    </div>

    <section class="panels" id="panels" aria-live="polite">
      <article class="panel" data-index="0" aria-expanded="false" tabindex="0">
        <h3><span>1. Job Title</span></h3>
        <div class="body" hidden>
          <p>
            Electrical Power Production Craftsman →
            Power Production Supervisor →
            Contingency Training Supervisor →
            Team Lead / SME (BEAR, TFS, WRM, AMMPS) →
            Software Developer-in-Training (MSSA Cloud Application Development)
          </p>
        </div>
      </article>

      <article class="panel" data-index="1" aria-expanded="false" tabindex="0">
        <h3><span>2. Age</span></h3>
        <div class="body" hidden>
          <ul>
            <li>18–20: Trainee, Apprentice Power Production</li>
            <li>21–25: Journeyman, Iraq/Afghanistan deployments, crisis operations</li>
            <li>26–30: Senior Craftsman, program builder, inspection reform</li>
            <li>31–35: NCOIC roles, global deployments, instructor-level performance</li>
            <li>36–38: Senior NCO, Workforce leader, Equipment Custodian for $258M assets</li>
            <li>38: Software Development student (C#, Azure, GitHub), MSSA Cohort CCAD21</li>
          </ul>
        </div>
      </article>

      <article class="panel" data-index="2" aria-expanded="false" tabindex="0">
        <h3><span>3. Likes</span></h3>
        <div class="body" hidden>
          <ul>
            <li>Building systems — generators, logistics programs, and now software.</li>
            <li>Solving problems under pressure — rockets, mortars, broken systems, bureaucracy.</li>
            <li>Teaching and mentoring — hundreds trained, supervisors coached, teams elevated.</li>
            <li>Structure with freedom — clear mission, with room to improve the process.</li>
            <li>Technology — PC building, AMMPS, C#, Visual Studio, GitHub, cloud apps.</li>
            <li>Meaningful work — missions that protect people or improve lives.</li>
            <li>Innovation — inspection toolsets, tracking systems, training programs.</li>
            <li>Calm environments — desert nights, storms, ocean waves, wide open spaces.</li>
            <li>Perseverance — thriving in challenges that require grit.</li>
          </ul>
        </div>
      </article>

      <article class="panel" data-index="3" aria-expanded="false" tabindex="0">
        <h3><span>4. Dislikes</span></h3>
        <div class="body" hidden>
          <ul>
            <li>Micromanagement — prefer trust, mission clarity, and autonomy.</li>
            <li>Broken systems with no intent to fix them — always improve what you touch.</li>
            <li>Pretension and arrogance — value humility and genuine leadership.</li>
            <li>Stagnation — need growth, movement, and learning.</li>
            <li>Toxic leadership — punishing instead of developing people.</li>
            <li>Inefficiency and sloppy processes — a zero-tolerance streak.</li>
            <li>Light pollution, noisy crowds, claustrophobic environments — prefer open horizons.</li>
            <li>Disloyalty and dishonesty — self-explanatory.</li>
          </ul>
        </div>
      </article>

      <article class="panel" data-index="4" aria-expanded="false" tabindex="0">
        <h3><span>5. Transferable Skills</span></h3>
        <div class="body" hidden>
          <h4>Leadership & People Development</h4>
          <ul>
            <li>Led 3–55 personnel across multiple missions and deployments.</li>
            <li>Lead Trainer — trained 800+ supervisors/managers on leadership, performance, and compliance.</li>
            <li>Mentored dozens of Airmen, accelerating upgrade training by months.</li>
            <li>Taught complex tasks under pressure (MAAS, BEAR Program, TFS systems, generator systems).</li>
          </ul>

          <h4>Systems Thinking & Process Design</h4>
          <ul>
            <li>Built a 2,022-line inspection system used across 12 programs.</li>
            <li>Created tracking databases and standardization toolsets.</li>
            <li>Identified inefficiencies and resolved multi-year backlogs.</li>
            <li>Designed operational checklists, packing plans, and workflow improvements.</li>
          </ul>

          <h4>Technical Problem Solving</h4>
          <ul>
            <li>Diagnosed and repaired high-value power systems (5kW–12.7kW).</li>
            <li>Managed $258M in global equipment, 428 UTCs, 12.5K O&M tasks.</li>
            <li>Executed global deployments supporting 11–16 CCMDs.</li>
            <li>Troubleshot AMMPS, generators, high-voltage, TFS, MAAS, and LAMS.</li>
            <li>BIOS/OS troubleshooting, PC rebuilds, electrical + mechanical foundation.</li>
          </ul>

          <h4>Operational & Project Management</h4>
          <ul>
            <li>Oversaw $4.6M in projects and contracts across 55 locations.</li>
            <li>Led airfield recovery operations protecting $1.2B in fighter aircraft.</li>
            <li>Managed logistics for 6–24 UTC deployments under urgent deadlines.</li>
            <li>Coordinated joint operations with Army, Marines, NATO, and international partners.</li>
          </ul>

          <h4>Instruction, Communication, UX Mindset</h4>
          <ul>
            <li>Built structured, user-focused systems to simplify compliance and operations.</li>
            <li>Designed training modules — clear, repeatable, “user-friendly” (early UX talent).</li>
            <li>Communicated across ranks and cultures, bridging technical and human needs.</li>
          </ul>

          <h4>Software & Cloud Foundations (MSSA + Microsoft Learn)</h4>
          <ul>
            <li>Completed 6 Learning Paths, 38 Modules, 33+ hours of Microsoft C# training.</li>
            <li>Passed all module assessments with full mastery.</li>
            <li>Earned Foundational C# Developer Certification (Microsoft + FreeCodeCamp).</li>
            <li>Built working console applications; debugged systems; implemented logic, arrays, exceptions.</li>
            <li>Actively developing cloud development skills (C#, .NET, GitHub, Azure).</li>
          </ul>

          <h4>Mindset</h4>
          <ul>
            <li>Resilient — operated under rockets, mortars, combat conditions.</li>
            <li>Mission-driven — shows up every time, no excuses.</li>
            <li>Fast learner — BA, C#, MSSA prerequisites, deployed duties.</li>
            <li>Systems builder — not just fixing problems; redesigning the blueprint.</li>
          </ul>
        </div>
      </article>
    </section>

    <footer>© 2025 EchoingTide1822 - James Gill</footer>
  </main>

  <!-- Hidden celebrate button -->
  <button id="hiddenCelebrate" aria-label="Secret celebration"></button>

  <!-- cursor elements -->
  <div id="cursorCore" class="cursor-core" aria-hidden="true"></div>
<script>
  // Audio files
  // const AMBIENT_SRC = 'ambient-space.mp3';
  // const SUSPENSE_SRC = 'space-suspense.mp3';

  // BUG FIX: Define overlay before using it
  const overlay = document.getElementById('warpOverlay');

  const ambientAudio = document.createElement('audio');
  ambientAudio.src = AMBIENT_SRC;
  ambientAudio.loop = true;
  ambientAudio.preload = 'auto';
  ambientAudio.volume = 0.55;

  const suspenseAudio = document.createElement('audio');
  suspenseAudio.src = SUSPENSE_SRC;
  suspenseAudio.loop = true;
  suspenseAudio.preload = 'auto';
  suspenseAudio.volume = 0.0;

  // Only append if overlay exists
  if (overlay) {
    overlay.appendChild(ambientAudio);
    overlay.appendChild(suspenseAudio);
  }

  safePlay(ambientAudio,'ambient');
  suspenseAudio.load();

  function safePlay(a,label){
    a.play().catch(err=>{
      const resume = () => {
        a.play().catch(()=>{});
        document.removeEventListener('click', resume, true);
        document.removeEventListener('keydown', resume, true);
      };
      document.addEventListener('click', resume, true);
      document.addEventListener('keydown', resume, true);
    });
  }

  // Video management
  let currentIndex = 0;
  let currentVid = null;
  let nextVid = null;
  let rateRAF = null;
  let finished = false;
  let fourthMetaReady = false;
  let blackFadeDone = false;
  const startWallClock = performance.now();

  playVideo(currentIndex);

  function createVideo(src){
    const v = document.createElement('video');
    v.className='warp-player';
    v.muted=true;
    v.playsInline=true;
    v.autoplay=true;
    v.preload='auto';
    v.loop=false;
    v.disablePictureInPicture=true;
    v.setAttribute('controlslist','nodownload nofullscreen noremoteplayback');
    v.style.position='absolute';
    v.style.inset='0';
    v.style.width='100%';
    v.style.height='100%';
    v.style.objectFit='cover';
    v.style.opacity='0';
    v.style.transition=`opacity ${CROSSFADE_SEC}s linear`;
    const s = document.createElement('source');
    s.src=src; s.type='video/mp4';
    v.appendChild(s);
    return v;
  }

  function playVideo(i){
    if(finished) return;
    if(i>=SOURCES.length){
      ensureTotalTimeOrFinish();
      return;
    }

    currentVid = createVideo(SOURCES[i]);
    overlay.appendChild(currentVid);

    currentVid.play().catch(()=>gesturePlay(currentVid));
    currentVid.addEventListener('loadeddata', ()=> requestAnimationFrame(()=> currentVid.style.opacity='1'));
    currentVid.addEventListener('error', ()=> skipToNext());
    currentVid.addEventListener('ended', ()=> skipToNext());

    if(i+1 < SOURCES.length){
      nextVid = createVideo(SOURCES[i+1]);
      overlay.appendChild(nextVid);
    }else{
      nextVid = null;
    }

    currentVid.addEventListener('loadedmetadata', ()=>{
      setupRate(i, currentVid);
      if(nextVid){
        const dur = currentVid.duration;
        scheduleCrossfade(Math.max(0, dur - CROSSFADE_SEC));
      }
      if(i===3){
        fourthMetaReady = true;
        currentVid.addEventListener('timeupdate', ambientReturnWatcher);
      }
      if(i===1){
        // Switch to suspense
        crossfadeAudio(ambientAudio, suspenseAudio, 1200);
      }
    });
  }

  function gesturePlay(v){
    const resume=()=>{ v.play().catch(()=>{}); document.removeEventListener('click',resume,true); };
    document.addEventListener('click', resume, true);
  }

  function crossfadeAudio(from,to,duration){
    const start = performance.now();
    const f0 = from.volume;
    const t0 = to.volume;
    if(to.paused) safePlay(to,'to');
    (function step(){
      const p = Math.min(1,(performance.now()-start)/duration);
      from.volume = f0*(1-p);
      to.volume = t0 + (0.55 - t0)*p;
      if(p<1) requestAnimationFrame(step);
    })();
  }

  function setupRate(i, vid){
    cancelRateLoop();
    const dur = vid.duration||0;
    const rampEnd = Math.max(0, dur - CROSSFADE_SEC);
    const rampStart = Math.max(0, rampEnd - FIRST_RAMP_SEC);

    function loop(){
      if(!vid || finished) return;
      const t = vid.currentTime;
      let rate = 1;

      if(i===0){
        if(t<=rampStart) rate=1;
        else if(t>=rampEnd) rate=FAST_RATE;
        else{
          const p=(t-rampStart)/(rampEnd-rampStart);
          rate=1+(FAST_RATE-1)*(p<0.5?4*p*p*p:1-Math.pow(-2*p+2,3)/2);
        }
      }else if(i===1){
        rate=1;
      }else if(i===2){
        rate=NAT_RATE;
      }else if(i===3){
        const slowStart = Math.max(0, dur - SLOW_DOWN_SEC);
        if(t<slowStart) rate=NAT_RATE;
        else{
          const p=(t-slowStart)/Math.max(0.001,dur-slowStart);
          rate = NAT_RATE - (NAT_RATE - FINAL_RATE)*(1-Math.pow(1-p,3));
        }
        // Trigger fade to black last second
        if(!blackFadeDone && isFinite(dur) && dur - t <= 1){
          blackFadeDone = true;
          const bf = document.getElementById('blackout');
          bf.classList.add('show');
          requestAnimationFrame(()=> bf.classList.add('visible'));
        }
      }

      vid.playbackRate = rate;
      rateRAF = requestAnimationFrame(loop);
    }
    loop();
  }

  function scheduleCrossfade(at){
    if(!currentVid || !nextVid) return;
    function watch(){
      if(!currentVid) return;
      if(currentVid.currentTime >= at){
        currentVid.removeEventListener('timeupdate', watch);
        nextVid.play().catch(()=>gesturePlay(nextVid));
        requestAnimationFrame(()=>{
          nextVid.style.opacity='1';
          currentVid.style.opacity='0';
        });
        setTimeout(()=>{
          if(currentVid){ currentVid.remove(); }
          currentIndex++;
          currentVid = nextVid;
          nextVid = null;
          playVideo(currentIndex);
        }, CROSSFADE_SEC*1000+60);
      }
    }
    currentVid.addEventListener('timeupdate', watch);
  }

  function skipToNext(){
    currentIndex++;
    if(currentVid) currentVid.remove();
    if(nextVid){
      currentVid = nextVid;
      nextVid = null;
      currentVid.style.opacity='1';
      currentVid.play().catch(()=>gesturePlay(currentVid));
      playVideo(currentIndex);
    }else{
      ensureTotalTimeOrFinish();
    }
  }

  function ambientReturnWatcher(){
    if(!currentVid || !fourthMetaReady) return;
    const dur = currentVid.duration;
    if(!isFinite(dur) || dur <= LAST_AMBIENT_SEC) return;
    const remaining = dur - currentVid.currentTime;
    if(remaining <= LAST_AMBIENT_SEC){
      currentVid.removeEventListener('timeupdate', ambientReturnWatcher);
      crossfadeAudio(suspenseAudio, ambientAudio, 1500);
    }
  }

  function ensureTotalTimeOrFinish(){
    const elapsed = performance.now() - startWallClock;
    if(elapsed < MIN_TOTAL_MS){
      if(!currentVid){
        currentVid = createVideo(SOURCES[SOURCES.length-1]);
        overlay.appendChild(currentVid);
        currentVid.play().catch(()=>gesturePlay(currentVid));
      }
      currentVid.loop = true;
      setupRate(SOURCES.length-1, currentVid);
      setTimeout(()=>finish(), MIN_TOTAL_MS - elapsed);
    } else {
      finish();
    }
  }

  function cancelRateLoop(){
    if(rateRAF) cancelAnimationFrame(rateRAF);
    rateRAF = null;
  }

  function finish(){
    if(finished) return;
    finished = true;
    cancelRateLoop();

    // Fade audio out
    const a1 = ambientAudio.volume;
    const a2 = suspenseAudio.volume;
    const D = 900;
    const t0 = performance.now();
    (function step(){
      const p = Math.min(1,(performance.now()-t0)/D);
      ambientAudio.volume = a1*(1-p);
      suspenseAudio.volume = a2*(1-p);
      if(p<1) requestAnimationFrame(step);
      else{
        try{ambientAudio.pause();}catch{}
        try{suspenseAudio.pause();}catch{}
        overlay.classList.remove('active');
        overlay.innerHTML='';
        const bf = document.getElementById('blackout');
        bf.classList.remove('visible');
        setTimeout(()=>bf.classList.remove('show'),500);
        const videoBg = document.getElementById('videoBg');
        if(videoBg) videoBg.style.opacity='1';
        const bgVideo = document.getElementById('bg-video');
        if(bgVideo){ try{ bgVideo.play(); }catch{} }
        isCinematic = false;
      }
    })();
  }

/* Manual audio test shortcuts */
document.addEventListener('keydown', e=>{
  if(e.key==='a'){ console.log('Ambient test'); }
  if(e.key==='s'){ console.log('Suspense test'); }
});
</script>
<script>
const $ = s => document.querySelector(s);
let isCinematic = false;

/* Config */
const SOURCES=[
  'Screensaver-1.mp4',
  'Screensaver-2.mp4',
  'Screensaver-3.mp4',
  'Screensaver-4.mp4'
];
const CROSSFADE_SEC=3;
const FIRST_RAMP_SEC=10;
const FAST_RATE=5;
const NAT_RATE=1.15;
const FINAL_RATE=0.5;
const MIN_TOTAL_MS=120000;
const PLANET_TIME_HINT=12;          // fallback: seconds into video 4 if auto-detect fails
const PLANET_DETECT_TIMEOUT_MS=8000;// give detection some time
const SLOW_AFTER_PLANET_SEC=5;      // duration of gradual slowdown after planet appears

/* Audio sources */
const AMBIENT_SRC='ambient-space.mp3';
const SUSPENSE_SRC='space-suspense.mp3';

/* Preload (optional) */
let preloadDone=false;
(function preload(){
  let done=0,total=SOURCES.length+2;
  [...SOURCES,'ambient-space.mp3','space-suspense.mp3'].forEach(f=>{
    const el=f.endsWith('.mp3')?document.createElement('audio'):document.createElement('video');
    el.preload='metadata'; el.src=f;
    el.addEventListener('loadedmetadata',mark,{once:true});
    el.addEventListener('error',mark,{once:true});
  });
  function mark(){ if(++done>=total){ preloadDone=true; } }
})();

document.addEventListener('DOMContentLoaded',()=>{
  $('#hiddenCelebrate')?.addEventListener('click',startCinematic);
});

/* Start */
function startCinematic(){
  if(isCinematic) return;
  isCinematic = true;

  const overlay = $('#warpOverlay');
  const bgVideo = $('#bg-video');
  const videoBg = $('#videoBg');
  overlay.classList.add('active');
  overlay.style.background = '#000';
  overlay.innerHTML = '';

  if(bgVideo){ try{ bgVideo.pause(); }catch{} }
  if(videoBg) videoBg.style.opacity = '0';

  // Audio elements (NOT muted)
  const ambient = document.createElement('audio');
  ambient.src = 'ambient-space.mp3';
  ambient.loop = true;
  ambient.volume = 0.7;
  ambient.preload = 'auto';

  const suspense = document.createElement('audio');
  suspense.src = 'space-suspense.mp3';
  suspense.loop = true;
  suspense.volume = 0.0;
  suspense.preload = 'auto';

  overlay.appendChild(ambient);
  overlay.appendChild(suspense);

  // Try to play both, fallback to user gesture if blocked
  function safePlay(a){
    a.play().catch(()=>{
      const resume = () => {
        a.play().catch(()=>{});
        document.removeEventListener('click', resume, true);
        document.removeEventListener('keydown', resume, true);
      };
      document.addEventListener('click', resume, true);
      document.addEventListener('keydown', resume, true);
    });
  }
  safePlay(ambient);
  suspense.load();

  // State
  let currentIndex=0;
  let currentVid=null;
  let nextVid=null;
  let rateRAF=null;
  let finished=false;
  let planetDetected=false;
  let slowdownStart=null;
  let slowdownActive=false;
  let startClock=performance.now();

  playVideo(0);

  function playVideo(i){
    if(finished) return;
    if(i>=SOURCES.length){ ensureTotalLength(); return; }

    currentVid=createVideo(SOURCES[i]);
    overlay.appendChild(currentVid);
    currentVid.play().catch(()=>gesturePlay(currentVid));
    currentVid.addEventListener('loadeddata',()=>requestAnimationFrame(()=>currentVid.style.opacity='1'));
    currentVid.addEventListener('error',skipToNext);
    currentVid.addEventListener('ended',skipToNext);

    if(i+1<SOURCES.length){
      nextVid=createVideo(SOURCES[i+1]);
      overlay.appendChild(nextVid);
    }else nextVid=null;

    currentVid.addEventListener('loadedmetadata',()=>{
      setupRate(i,currentVid);
      if(nextVid){
        scheduleCrossfade(currentVid.duration-CROSSFADE_SEC);
      }
      if(i===1){ crossfadeAudio(ambient,suspense,1200); }
      if(i===3){ startPlanetDetection(currentVid); }
    });
  }

  function createVideo(src){
    const v=document.createElement('video');
    v.className='warp-player';
    v.muted=true; v.playsInline=true; v.autoplay=true; v.preload='auto';
    v.loop=false; v.setAttribute('controlslist','nodownload nofullscreen noremoteplayback');
    v.style.cssText='position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity '+CROSSFADE_SEC+'s linear;background:#000';
    const s=document.createElement('source'); s.src=src; s.type='video/mp4'; v.appendChild(s);
    return v;
  }

  function scheduleCrossfade(at){
    if(!currentVid||!nextVid) return;
    function watch(){
      if(!currentVid) return;
      if(currentVid.currentTime>=at){
        currentVid.removeEventListener('timeupdate',watch);
        nextVid.play().catch(()=>gesturePlay(nextVid));
        requestAnimationFrame(()=>{
          nextVid.style.opacity='1';
          currentVid.style.opacity='0';
        });
        setTimeout(()=>{
          currentVid?.remove();
          currentIndex++;
          currentVid=nextVid; nextVid=null;
          playVideo(currentIndex);
        },CROSSFADE_SEC*1000+40);
      }
    }
    currentVid.addEventListener('timeupdate',watch);
  }

  function skipToNext(){
    currentIndex++;
    currentVid?.remove();
    if(nextVid){
      currentVid=nextVid; nextVid=null;
      currentVid.style.opacity='1';
      currentVid.play().catch(()=>gesturePlay(currentVid));
      playVideo(currentIndex);
    }else ensureTotalLength();
  }

  function setupRate(i,vid){
    cancelRateLoop();
    const dur=vid.duration||0;
    const rampEnd=Math.max(0,dur-CROSSFADE_SEC);
    const rampStart=Math.max(0,rampEnd-FIRST_RAMP_SEC);

    function loop(){
      if(!vid||finished) return;
      let rate=1;
      const t=vid.currentTime;

      if(i===0){
        if(t<=rampStart) rate=1;
        else if(t>=rampEnd) rate=FAST_RATE;
        else {
          const p=(t-rampStart)/(rampEnd-rampStart);
          rate=1+(FAST_RATE-1)*(p<0.5?4*p*p*p:1-Math.pow(-2*p+2,3)/2);
        }
      }else if(i===1){
        rate=1;
      }else if(i===2){
        rate=NAT_RATE;
      }else if(i===3){
        if(planetDetected){
          if(!slowdownActive){
            slowdownActive=true;
            slowdownStart=performance.now();
          }
          const p=Math.min(1,(performance.now()-slowdownStart)/(SLOW_AFTER_PLANET_SEC*1000));
          rate=NAT_RATE-(NAT_RATE-FINAL_RATE)*(p<0.5?4*p*p*p:1-Math.pow(-2*p+2,3)/2);
          // Fade to black last 1s of slowdown
          const remainingSlow = SLOW_AFTER_PLANET_SEC*1000 - (performance.now()-slowdownStart);
          if(remainingSlow <= 1000) triggerBlackFade();
        }else{
          rate=NAT_RATE;
        }
      }

      vid.playbackRate=rate;
      rateRAF=requestAnimationFrame(loop);
    }
    loop();
  }

  function startPlanetDetection(video){
    const canvas=document.createElement('canvas');
    const ctx=canvas.getContext('2d');
    canvas.width=160; canvas.height=90;
    let attempts=0;
    let fallbackStarted=false;
    function sample(){
      if(planetDetected||finished||video.paused||video.ended) return;
      attempts++;
      try{
        ctx.drawImage(video,0,0,canvas.width,canvas.height);
        const data=ctx.getImageData(0,0,canvas.width,canvas.height).data;
        // Central area
        let bright=0,total=0;
        const x0=Math.floor(canvas.width*0.3),x1=Math.floor(canvas.width*0.7);
        const y0=Math.floor(canvas.height*0.3),y1=Math.floor(canvas.height*0.7);
        for(let y=y0;y<y1;y++){
          for(let x=x0;x<x1;x++){
            const i=(y*canvas.width+x)*4;
            const r=data[i],g=data[i+1],b=data[i+2];
            const lum=0.2126*r+0.7152*g+0.0722*b;
            if(lum>170) bright++;
            total++;
          }
        }
        const ratio=bright/total;
        // Heuristic: large bright central object
        if(ratio>0.28){
          planetDetected=true;
          crossfadeAudio(suspense,ambient,1200);
          return;
        }
      }catch{}
      if(!planetDetected){
        if(attempts<200){
          setTimeout(sample,150);
        }else if(!fallbackStarted){
          fallbackStarted=true;
          setTimeout(()=>{
            if(!planetDetected){
              planetDetected=true;
              crossfadeAudio(suspense,ambient,1200);
            }
          }, PLANET_DETECT_TIMEOUT_MS);
        }
      }
    }
    sample();
    // Fallback by hint time
    video.addEventListener('timeupdate',()=>{
      if(!planetDetected && video.currentTime>=PLANET_TIME_HINT){
        planetDetected=true;
        crossfadeAudio(suspense,ambient,1000);
      }
    });
  }

  function triggerBlackFade(){
    const bf=$('#blackout');
    if(!bf) return;
    bf.classList.add('show');
    requestAnimationFrame(()=>bf.classList.add('visible'));
  }

  function ensureTotalLength(){
    const elapsed=performance.now()-startClock;
    if(elapsed<MIN_TOTAL_MS){
      if(!currentVid){
        currentVid=createVideo(SOURCES[SOURCES.length-1]);
        overlay.appendChild(currentVid);
        currentVid.play().catch(()=>gesturePlay(currentVid));
      }
      currentVid.loop=true;
      setupRate(SOURCES.length-1,currentVid);
      setTimeout(()=>finish(),MIN_TOTAL_MS-elapsed);
    }else finish();
  }

  function finish(){
    if(finished) return;
    finished=true;
    cancelRateLoop();
    // Final fade already active; delay clear
    fadeOutAudio(()=> {
      overlay.classList.remove('active');
      overlay.innerHTML='';
      const bf=$('#blackout');
      bf.classList.remove('visible');
      setTimeout(()=>bf.classList.remove('show'),600);
      if(videoBg) videoBg.style.opacity='1';
      const bgVideo=$('#bg-video');
      if(bgVideo){try{bgVideo.play();}catch{}}
      isCinematic=false;
    });
  }

  function fadeOutAudio(cb){
    const a1=ambient.volume,a2=suspense.volume;
    const D=900,t0=performance.now();
    (function step(){
      const p=Math.min(1,(performance.now()-t0)/D);
      ambient.volume=a1*(1-p);
      suspense.volume=a2*(1-p);
      if(p<1) requestAnimationFrame(step); else{
        try{ambient.pause();}catch{}
        try{suspense.pause();}catch{}
        cb&&cb();
      }
    })();
  }

  function crossfadeAudio(from,to,dur){
    const start=performance.now();
    const f0=from.volume,t0=to.volume;
    safePlay(to);
    (function step(){
      const p=Math.min(1,(performance.now()-start)/dur);
      from.volume=f0*(1-p);
      to.volume=t0+(0.55-t0)*p;
      if(p<1) requestAnimationFrame(step);
    })();
  }

  function gesturePlay(v){
    const resume=()=>{ v.play().catch(()=>{}); document.removeEventListener('click',resume,true); };
    document.addEventListener('click',resume,true);
  }

  function safePlay(a){
    a.play().catch(()=> {
      const resume=()=>{a.play().catch(()=>{});document.removeEventListener('click',resume,true);};
      document.addEventListener('click',resume,true);
    });
  }

  function cancelRateLoop(){ if(rateRAF) cancelAnimationFrame(rateRAF); rateRAF=null; }
}
</script>
<script>
(function themeCycleInit(){
  const btn = document.getElementById('themeToggleBtn');
  const classes = ['theme-a','theme-b','theme-c','theme-d','theme-e'];
  let idx = 0;

  function apply(){
    document.body.classList.remove(...classes);
    document.body.classList.add(classes[idx]);
  }
  function next(){
    idx = (idx + 1) % classes.length;
    apply();
    // Light pulse feedback
    document.body.animate([
      {filter:'brightness(3)'},
      {filter:'brightness(1.25)'},
      {filter:'brightness(3)'},
      {filter:'brightness(1)'}
    ],{duration:600,easing:'cubic-bezier(0.5,0,0.5,1)',fill:'forwards'});
  }

  // Init
  apply();
  btn.addEventListener('click',next);
  document.addEventListener('keydown',e=>{ if(e.key==='t') next(); });
})();
</script>
</body>
</html>